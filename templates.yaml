# OpenWebRX additional template sensors based on attributes
# All depend on Ping sensor 'binary_sensor.webrx_lan' to check connection
# of the WebSDR.

# Shows the last FT8 decoded callsign
# Depends on mqtt sensor 'sensor.openwebrx_ft8'
- sensor:
  - name: webrx-ft8-callsign
    state: >
      {% if is_state('binary_sensor.webrx_lan', 'on') %}
      {{ state_attr( 'sensor.openwebrx_ft8', 'callsign') }}
      {% else %}
      {{ "unavailable" }}
      {% endif %}
    icon: mdi:radio

# Time elapsed since last FT8 decode
# Depends on mqtt sensor 'sensor.openwebrx_ft8'
- sensor:
  - name: webrx-ft8-min_ago
    device_class: duration
    unit_of_measurement: "min"
    state: >
      {{ (( as_timestamp(now()) - state_attr( 'sensor.openwebrx_ft8', 'timestamp')/1000 )/ 60) | round(1) }}
    icon: mdi:clock

# Shows the selected SDR of the last profile switch
# Depends on mqtt sensor 'sensor.openwebrx_rx'
- sensor:
  - name: webrx-rx-source
    state: >
      {% if is_state('binary_sensor.webrx_lan', 'on') %}
      {{ state_attr( 'sensor.openwebrx_rx', 'source') }}
      {% else %}
      {{ "unavailable" }}
      {% endif %}
    icon: mdi:radio

# Shows all connected SDRs
# Depends on rest sensor 'sensor.openwebrx_version'
- sensor:
  - name: sdr_connected
    state: >
      {% for j in state_attr( 'sensor.openwebrx_version', 'sdrs') -%}
      {{ j.name }}
      {% endfor %}
    icon: mdi:radio
